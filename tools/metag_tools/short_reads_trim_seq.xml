<tool id="trim_reads" name="Trim Reads" version="1.0.0">
<description>based on quality scores</description>

<command interpreter="python">
 short_reads_trim_seq.py $trim $length $output1 $input1 $input2 $sequencing_method_choice.input3
</command>
<inputs>
<page>
    <param name="input1" type="data" format="fasta,txtseq.zip" label="Sequence file" />
    <param name="input2" type="data" format="qualityscore,txtseq.zip" label="Quality score file" />
	<param name="trim" type="integer" size="5" value="20" label="Minimal quality score" />
    <param name="length" type="integer" size="5" value="0" label="Minimal length of trimmed reads to report" help="To output the read if its length is longer than this threshold. Use 0 to return the longest substring." />
    <conditional name="sequencing_method_choice">
        <param name="sequencer" type="select" label="Short read sequencing method">
            <option value="454">454</option>
            <option value="Solexa">Solexa</option>
        </param>
        <when value="454">
            <param name="input3" type="select" label="To keep homopolymers" >
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </param>
        </when>
        <when value="Solexa">
            <param name="input3" type="integer" size="5" value="0" label="Trim reads after this position" help="0 as do nothing" />
        </when> 
    </conditional>
</page>
</inputs>

<outputs>
    <data name="output1" format="fasta" />
</outputs>

<tests>
	<test>
		<param name="sequencer" value="454" />
		<param name="input1" value="454.fasta" ftype="fasta" />
		<param name="input2" value="454.qualityscore" ftype="qualityscore" />
		<param name="input3" value="no" />
		<param name="trim" value="20" />
		<param name="length" value="0" />
		<output name="output1" file="short_reads_trim_seq_out1.fasta" />
	</test>
	<test>
		<param name="sequencer" value="Solexa" />
		<param name="input1" value="solexa.fasta" ftype="fasta" />
		<param name="input2" value="solexa.qualityscore" ftype="qualityscore" />
		<param name="input3" value="0" />
		<param name="trim" value="20" />
		<param name="length" value="0" />
		<output name="output1" file="short_reads_trim_seq_out2.fasta" />
	</test>
</tests>

<help>
  
.. class:: warningmark

 To use this tool your quality score dataset needs to be in *Quality Score* format. Click pencil icon next to your dataset to set datatype to *Quality Score*.
 
-----

**What it does**

This tool takes Sequencing Files and Quality Files generated by Roche (454), Illumina (Solexa), or ABI SOLiD machines and trims the sequences based on the quality scores.

- If *minimal length of trimmed reads to report* is set to a number larger than zero, the tool ouputs any substrings that are longer than this threshold.
 
- If *minimal length of trimmed reads to report* is set to zero, and several substrings are of the same maximal length, the tool outputs all of them in separated fasta format.

-----

**Example 1.**

For 454 and SOLiD files

- the sequence file is fasta format as following::
	
	&gt;seq1
	CCGGTATCCG
	
- and the score file is also a fasta-like format::

	&gt;quality score for seq1
	33 19 34 25 28 28 28 32 15 34 

- if use **20** as *minimal quality score*, and
- use **0** as *minimal length of trimmed reads to report*

- the output will return the longest substring::

	&gt;seq1
	GGTATC

-----

**Example 2.**

For Solexa files

- the sequence file is fasta format as following::

	5	300	902	419	TTCTTACCTATTAGTGGTTGAACATC
	
- please use *Convert-Formats --> Tabular-to-FASTA* to convert the sequence file into fasta format::

    &gt;5_300_902_419
    TTCTTACCTATTAGTGGTTGAACATC
    
- and the score file is also a fasta-like format::

 	40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 15 40
	
	Note: only showed the maximum score here

- if use **20** as *minimal quality score*, and
- use **0** as *minimal length of trimmed reads to report*

- the output will return the longest substring::  

	&gt;5_300_902_419
	TTCTTACCTATTAGTGGTTGAACA
	

-----

**Note**. Fasta title changed if there was more than one candidate.

If several substrings are of the same maximal length or longer than the non-zero threshold, all the substrings will be outputted. The new fasta title will be the original title with an underscore symbol and a number representing the order of the substrings.

- The length of the longest substring is 6 and three substrings are of this length::

	&gt;seq1_0
	GGTATC
	&gt;seq1_1
	AATATC
	&gt;seq1_2
	GGTATC

- The *minimal length of trimmed reads to report* is 10 and two substrings are longer than this threshold::

	&gt;15774_0
	TTCTTACCTAGTGGTATTAGTGGTTGAACA
	&gt;15774_1
	ACCTATTACCTAGGTGGTTGA

</help>
</tool>
