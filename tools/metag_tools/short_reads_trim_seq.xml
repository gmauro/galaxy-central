<tool id="trim_reads" name="Trim Reads" version="1.0.0">
<description>based on quality scores</description>

<command interpreter="python">#if $sequencing_method_choice.sequencer=="454":#short_reads_trim_seq.py 454 $trim $length $output1 $sequencing_method_choice.input1 $sequencing_method_choice.input2 $sequencing_method_choice.input3
#else:#short_reads_trim_seq.py solexa $trim $length $output1 $sequencing_method_choice.input1 $sequencing_method_choice.input2 $sequencing_method_choice.input3
#end if
</command>

<inputs>
<page>
	<conditional name="sequencing_method_choice">
		<param name="sequencer" type="select" label="short read sequencing method">
			<option value="454">454 and SOLiD</option>
			<option value="Solexa">Solexa</option>
		</param>
		<when value="454">
		    <param name="input1" type="data" format="fasta,txtseq.zip" label="Sequence file" />
    		<param name="input2" type="data" format="qualityscore,txtseq.zip" label="Score file" />
    		<param name="input3" type="select" label="To keep homopolymers" >
    			<option value="yes">Yes</option>
    			<option value="no">No</option>
    		</param>
		</when>
		<when value="Solexa">
    		<param name="input1" type="data" format="tabular,txtseq.zip" label="Sequence file" />
    		<param name="input2" type="data" format="qualityscore,txtseq.zip" label="Score file" />
    		<param name="input3" type="integer" size="5" value="0" label="Trim reads after this position" help="0 as do nothing" />
		</when>	
	</conditional>
	<param name="trim" type="integer" size="5" value="20" label="Minimal quality score" />
    <param name="length" type="integer" size="5" value="0" label="Minimal length of trimmed reads to report" help="To output the read if its length is longer than this threshold. Use 0 to return the longest substring" />
</page>
</inputs>

<outputs>
    <data name="output1" format="fasta" />
</outputs>

<tests>
	<test>
		<param name="sequencer" value="454" />
		<param name="input1" value="454.fna" />
		<param name="input2" value="454.qual" ftype="qualityscore" />
		<param name="input3" value="no" />
		<param name="trim" value="20" />
		<param name="length" value="0" />
		<output name="output1" file="454Test.fa" />
	</test>
	<test>
		<param name="sequencer" value="Solexa" />
		<param name="input1" value="solexa.fna" />
		<param name="input2" value="solexa.qual" ftype="qualityscore" />
		<param name="input3" value="0" />
		<param name="trim" value="20" />
		<param name="length" value="0" />
		<output name="output1" file="solexaTest.fa" />
	</test>
</tests>

<help>

.. class:: warningmark 

 Please select correct sequencing method.
  
.. class:: warningmark 

Your **Quality Score** file needs to be a specific Galaxy **qualityscore** datatype (unless it is in zip format). Please click on the pencil symbol in the history panel to change the file format.
 
-----

**What it does**

This tool takes raw data from sequencing facility and outputs a multi-fasta file.

Accept the following two file formats:

- fasta: for **454** and **SOLiD** data
- tabular: for **Solexa** data. Only take the maximal value from each 4 quality scores.

If *minimal length of trimmed reads to report* is set to a number larger than zero, the tool ouputs any substrings that are longer than this threshold. 
If there are more than one substring, the tool outputs all of them in separated fasta format.

-----

**Example 1.**

For 454 and SOLiD files

- the sequence file is fasta format as following::
	
	&gt;seq1
	CCGGTATCCG
	
- and the score file is also a fasta-like format::

	&gt;quality score for seq1
	33 19 34 25 28 28 28 32 15 34 

- if use **20** as *minimal quality score*, and
- use **0** as *minimal length of trimmed reads to report*

- the output will return the longest sub-sequence::

	&gt;seq1
	GGTATC

-----

**Example 2.**

For Solexa files

- the sequence file is fasta format as following::

	5	300	902	419	TTCTTACCTATTAGTGGTTGAACATC
	
- and the score file is also a fasta-like format::

 	40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 15 40
	
	Note: only showed the maximum score here

- if use **20** as *minimal quality score*, and
- use **0** as *minimal length of trimmed reads to report*

- the output will return the longest sub-sequence::  

	&gt;15774
	TTCTTACCTATTAGTGGTTGAACA
	
	Note: The fasta title will be replaced by a unique number in Solexa output.

</help>
</tool>
