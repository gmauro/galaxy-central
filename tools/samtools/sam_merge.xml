<tool id="sam_merge" name="Merge BAM Files" version="1.1.1">
  <description>merges BAM files together</description>
  <requirements>
    <requirement type="package">samtools</requirement>
  </requirements>
  <command interpreter="python">
    sam_merge.py 
      $input1
      $output1
      $input2
      #for $i in $inputs
        ${i.input}
      #end for
  </command>
  <inputs>
    <param name="input1" label="First file" type="data" format="bam" />
    <param name="input2" label="with file" type="data" format="bam" help="Need to add more files? Use controls below." />
    <repeat name="inputs" title="Input Files">
      <param name="input" label="Add file" type="data" format="bam" />
    </repeat>
  </inputs>
  <outputs>
    <data format="bam" name="output1" label="${tool.name} on ${on_string}: merged BAM" />
  </outputs>
  <tests>
    <!-- TODO: add ability to test framework to test without at least 
         one repeat element value
    <test>
    -->
      <!--
      Bam merge command:
      samtools merge test-data/sam_merge_out1.bam test-data/sam_merge_in1.bam test-data/sam_merge_in2.bam
      -->
    <!--
      <param name="input1" value="sam_merge_in1.bam" ftype="bam" /> 
      <param name="input2" value="sam_merge_in2.bam" ftype="bam" />
      <output name="output1" file="sam_merge_out1.bam" ftype="bam" />
    </test>
    -->
    <test>
      <!--
      Bam merge command:
      samtools merge sam_merge_out2.bam test-data/sam_merge_in1.bam test-data/sam_merge_in2.bam test-data/sam_merge_in3.bam
      -->
      <param name="input1" value="sam_merge_in1.bam" ftype="bam" /> 
      <param name="input2" value="sam_merge_in2.bam" ftype="bam" />
      <param name="input" value="sam_merge_in3.bam" ftype="bam" />
      <output name="output1" file="sam_merge_out2.bam" ftype="bam" />
    </test>
    <!-- TODO: add ability to test code to be able to test with multiple 
         inputs (parameters with same value)
    <test>
    -->
      <!--
      Bam merge command:
      samtools merge test-data/sam_merge_out3.bam test-data/sam_merge_in1.bam test-data/sam_merge_in2.bam test-data/sam_merge_in3.bam test-data/sam_merge_in4.bam
      -->
    <!--
      <param name="input1" value="sam_merge_in1.bam" ftype="bam" /> 
      <param name="input2" value="sam_merge_in2.bam" ftype="bam" />
      <param name="input" value="sam_merge_in3.bam" ftype="bam" />
      <param name="input" value="sam_merge_in4.bam" ftype="bam" />
      <output name="output1" file="sam_merge_out3.bam" ftype="bam" />
    </test>
    -->
  </tests>
  <help>

**What it does**

This tool uses SAMTools_' merge command to merge any number of BAM files together into one BAM file.

.. _SAMTools: http://samtools.sourceforge.net/samtools.shtml

  </help>
</tool>
