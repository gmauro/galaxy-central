<tool id="mapsplice1" name="MapSplice" version="0.1">
   <description>"for splice junction discovery in RNAseq data"</description>
   <command interpreter="python"> 
rgmapsplice.py -e "${GALAXY_DATA_INDEX_DIR}/shared/python/mapsplice/mapsplice_segments.py" -u $input_file
-B ${filter( lambda x: str( x[0] ) == str( $genomeSource.index ), $__app__.tool_data_tables[ 'bowtie_indexes' ].get_fields() )[0][-1]}
-c ${filter( lambda x: str( x[0] ) == str( $genomeSource.index ), $__app__.tool_data_tables[ 'all_chrom_fasta' ].get_fields() )[0][-1]}
-o $out_html.files_path -t "$out_html" -L "$seglen" -E "$segmismatches" --outsam $out_sam -w $readlen -Q fq
--mapsegdir "$mapsegdir" --semican "$semican" --fuscan "$fuscan" --fusion "$fusion" --searchwhole "$searchwhole" --fullrun "$fullrun" 
    </command>
  <inputs>
    <param name="input_file" type="data" label="FASTQ file from your history" format="fastq,fastqsanger" />
      <conditional name="genomeSource">    
      <param name="refGenomeSource" type="select" help="This tool needs a reference genome. Default is usually right"
         label="Align to which reference genome? - default, built-in or choose from current history">
        <option value="default" selected="true">Default - use the input data genome/build</option>
        <option value="indexed">Select a different built-in genome</option>
      </param>
      <when value="default">
        <param name="index" type="select" label="Select a default reference genome">
          <options from_data_table="bowtie_indexes">
          <filter type="data_meta" ref="input_file" key="dbkey" column="dbkey" multiple="True" separator="," />
          <validator type="no_options" message="No reference build available for selected input" /> 
          </options>
        </param>
      </when>
      <when value="indexed">
        <param name="index" type="select" label="Select a built-in reference genome" >
          <options from_data_table="bowtie_indexes">
          </options>
        </param>
      </when>
    </conditional>
    <param name="readlen" value="36" type="integer" label="Length of reads" 
    help="Read length for reads in the input data" />
    <param name="seglen" value="18" type="integer" label="Length of read segments" 
    help="Suggested to be in range of 18-25. Should not be longer than half of the read length or over 25" />
    <param name="segmismatches" value="1" type="integer" 
    label="Maximum mismatches (Hamming distance) allowed in an unspliced aligned read and a segment" 
    help="Default is 1. Must be in range 0-3" />
    <param name="semican" type="select" label="Whether or not the semi-canonical and non-canonical junctions should be output">
    <option value="" selected="true">Default - Output only canonical junctions</option>
    <option value="--semi-canonical"> Output only canonical and semi-canonical junctions</option>
    <option value="--non-canonical">Output ALL junctions</option>
    </param>
    <param name="fuscan" type="select" label="Whether or not the semi-canonical and non-canonical fusion junctions should be output">
    <option value="" selected="true">Default - Output only canonical fusion junctions</option>
    <option value="--fusion-semi-canonical" >Output only canonical and semi-canonical fusion junctions</option>
    <option value="--fusion-non-canonical">Output ALL fusion junctions</option>
    </param>
    <param name="fusion" value="false" type="boolean"  label="Whether or not fusion junctions should be output"
      truevalue="--fusion" falsevalue="" checked="no" />
    <param name="mapsegdir" value="false" type="boolean"  label="Try to find spliced alignments and unspliced alignments of a read, and select the best alignment"
      truevalue="--map-segments-directly" falsevalue="" checked="no" help="Default = no. Setting this true will increase running time"/>
    <param name="searchwhole" value="false" type="boolean"  label="If specified, search up to the maximum intron length away in exonic region and non-exonic region"
      truevalue="--search-whole-chromosome" falsevalue="" checked="no" />
    <param name="fullrun" value="false" type="boolean"  label="If specified, run a remapping step to increase the junction coverage"
      truevalue="--full-running" falsevalue="" checked="no" />
  </inputs>
  <outputs>
    <data format="sam" name="out_sam" label="${input_file.name}_mapsplice.sam" />
    <data format="html" name="out_html" label="${input_file.name}_mapsplice.html" />
  </outputs>

  <help>

**Note**

MapSplice is an experimental tool currently under test

Full documentation is available at MapSplice_

----

**What this tool does**

This tool an arbitrary number of fasta or fastq files containing RNAseq reads and maps them to the reference genome with splice junction detection.

----

**Attribution**

Please see the MapSplice_ web site for full attribution and documentation of the executable this Galaxy wrapper will invoke. 

This wrapper was written by Ross Lazarus and is licensed under the LGPL_ like other rgenetics artefacts

.. _MapSplice: http://www.netlab.uky.edu/p/bioinfo/MapSplice
.. _LGPL: http://www.gnu.org/copyleft/lesser.html

  </help>

</tool>





