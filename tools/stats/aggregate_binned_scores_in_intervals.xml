<tool id="aggregate_scores_in_intervals2" description="such as phastCons, GERP, binCons, and others for a set of genomic intervals" name="Aggregate datapoints">
  <description>Appends the average, min, max of datapoints per interval</description>
  <command interpreter="python2.4">aggregate_scores_in_intervals.py $datasets $input1 $input1_chromCol $input1_startCol $input1_endCol $out_file1 -b</command>
  <inputs>
    <param format="interval" name="input1" type="data" label="Interval file"/>
    <param name="datasets" type="select" label="Available datasets" display="radio">
      <select_options from_file="/depot/data2/galaxy/binned_scores.loc" data_ref="input1" func="get_options_for_build" />
    </param>
  </inputs>
  <outputs>
    <data format="interval" name="out_file1" metadata_source="input1"/>
  </outputs>
  <tests>
    <test>
      <param name="input1" value="6.bed" dbkey="hg17" ftype="bed"/>
      <param name="datasets" value="/depot/data2/galaxy/binned_scores/hg17/phastcons_encode_sep2005_tba" />
      <output name="out_file1" file="aggregate_binned_scores_in_intervals.out" />
    </test>
    <test>
      <param name="input1" value="9_hg18.bed" dbkey="hg18" ftype="bed"/>
      <param name="datasets" value="/depot/data2/galaxy/binned_scores/hg18/phastCons17way/ba" />
      <output name="out_file1" file="aggregate_binned_scores_in_intervals2.out" />
    </test>
  </tests>
  <help>

.. class:: warningmark

This tool currently only works with data from genome builds hg16, hg17 or hg18.

.. class:: warningmark

This tool assumes that the input dataset is in interval format and contains at least a chrom column, a start column and an end column.  These 3 columns can be dispersed throughout any number of other data columns. 

-----

.. class:: infomark

**TIP:** Computing summary information may throw exceptions if the data type (e.g., string, integer) in every line of the columns is not appropriate for the computation (e.g., attempting numerical calculations on strings).  If an exception is thrown when computing summary information for a line, that line is skipped as invalid for the computation.  The number of invalid skipped lines is documented in the resulting history item as a "Data issue".

-----

**Syntax**

This tool appends columns of summary information for each interval matched against a selected dataset.  For each interval, the average, minimum and maximum for the data falling within the interval is computed.

- Several quantitative scores are provided for the ENCODE regions.

  - Various Scores
      - Regulatory Potential
      - Neutral rate (Ancestral Repeats)
      - GC fraction
  - Conservation Scores
      - PhastCons
      - binCons
      - GERP

-----

**Example**

If your original data has the following format:

+------+-----+-----+---+------+
|other1|chrom|start|end|other2|
+------+-----+-----+---+------+

and you choose to aggregate phastCons scores, your output will look like this:

+------+-----+-----+---+------+---+---+---+
|other1|chrom|start|end|other2|avg|min|max|
+------+-----+-----+---+------+---+---+---+

where:

* **avg** - average phastCons score for each region
* **min** - minimum phastCons score for each region
* **max** - maximum phastCons score for each region

  </help>
</tool>
