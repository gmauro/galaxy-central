<tool id="mutation_visualize" name="Mutation Visualization" version="1.0.0">
  <description></description>
  <command interpreter="python">
    visualize.py 
        --input-file=$input1
        --output-file=$out_file1
        --zoom=$zoom_value
        --position_col=$position_col
        --ref_col=$ref_col
        #for $f in $sample_chooser:
            "${f.name}"
            ${f.a_col}
            ${f.totals_col}
        #end for
  </command>
  <inputs>
    <param format="tabular" name="input1" type="data" label="Compare sequences in"></param>
    <param name="position_col" type="data_column" data_ref="input1" multiple="false" numerical="false" label="Position Column" help="" />
    <param name="ref_col" type="data_column" data_ref="input1" multiple="false" numerical="false" label="Reference Base Column" help="" />

    <repeat name="sample_chooser" title="Sample">
      <param name="name" type="text" label="Label" help="Optional" />
      <param name="a_col" type="data_column" data_ref="input1" multiple="false" numerical="false" label="A Column" help="" />
      <param name="totals_col" type="data_column" data_ref="input1" multiple="false" numerical="false" label="Totals Column" help="" />
    </repeat>

    <param name="zoom_value" type="select" label="Zoom">
        <option value="1">1x</option>
        <option value="2">2x</option>
        <option value="3">3x</option>
        <option value="4">4x</option>
        <option value="5">5x</option>
        <option value="interactive">Interactive</option>
    </param>
    
  </inputs>
  <outputs>
    <data format="svg" name="out_file1" />
  </outputs>
  <tests>
    <test>
      <param name="input1" value="mutation_data1.txt" ftype="tabular" />
      <param name="position_col" value="2" />
      <param name="ref_col" value="4" />
      <param name="zoom_value" value="interactive" />
      <param name="name" value="s1" />
      <param name="a_col" value="5" />
      <param name="totals_col" value="9" />
      <output name="output" file="mutation_data1_interactive.svg" ftype="svg" />
    </test>
    <test>
      <param name="input1" value="mutation_data1.txt" ftype="tabular" />
      <param name="position_col" value="2" />
      <param name="ref_col" value="4" />
      <param name="zoom_value" value="3" />
      <param name="name" value="s1" />
      <param name="a_col" value="5" />
      <param name="totals_col" value="9" />
      <output name="output" file="mutation_data1_zoom3x.svg" ftype="svg" />
    </test>
  </tests>
  <help>

**Example**

This tool allows you to visualize mutations described in a tabular input file. It generates an SVG image which can be viewed in any web browser.

Given the input file::
  
                              gm blood                                    gm cheek
  chrM    72      73      G   26394   4       49  0   26447   26398   1   23389   3       45  0   23437   23392   1
  chrM    149     150     T   11      50422   2   96  50531   50435   1   4       45417   1   65  45487   45422   1
  
You will need to specify the position and reference columns in the input file. Then click on the 'Add new Sample' to add samples in the input file that you would like to visualize. For each sample you select, specify the column for base 'A' and the totals column.
This tool assumes the columns specifying bases A, C, G, T are placed consecutively and in that order in an input file.

Visualization:

.. image:: ../static/images/mutation_visualization_example.png 
   :width: 150
   
Interactivity::
  If interactive zoom option is selected, then the resultant image can be zoomed in or out using the scroll mouse wheel and can be panned by dragging the image using left mouse button. 

  </help>
</tool>
