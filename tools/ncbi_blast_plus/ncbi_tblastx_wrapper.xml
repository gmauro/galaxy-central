<tool id="ncbi_tblastx_wrapper" name="NCBI BLAST+ tblastx" version="0.0.1">
    <description>Search translated nucleotide database with translated nucleotide query sequence(s)</description>
    <command>
      tblastx
       -query "$query"
       -db "$database"
       -evalue $evalue_cutoff
       -seg $adv_opts.filter_query
       -out $output1
       -outfmt $out_format
       -num_threads 8
    </command>
    <inputs>
        <param name="query" type="data" format="fasta" label="Nucleotide query sequence(s)"/> 
        <param name="database" type="select" display="radio" label="Nucelotide BLAST database">
            <options from_file="blastdb.loc">
              <column name="name" index="0"/>
              <column name="value" index="1"/>
            </options>
        </param>
        <param name="evalue_cutoff" type="float" size="15" value="0.001" label="set expectation value cutoff" />
        <param name="out_format" type="select" label="Output format">
            <option value="6">Tabular</option>
            <option value="5">BLAST XML</option>
            <option value="0">Pairwise text</option>
            <!--
            <option value="11">BLAST archive format (ASN.1)</option>
            -->
        </param>
        <conditional name="adv_opts">
            <param name="adv_opts_selector" type="select" label="Advanced Options">
              <option value="basic" selected="True">Hide Advanced Options</option>
              <option value="advanced">Show Advanced Options</option>
            </param>
            <when value="basic">
                <param name="filter_query" type="hidden" value="yes" />
            </when>
            <when value="advanced">
                <param name="filter_query" type="boolean" label="Filter out low complexity regions (with SEG)" truevalue="yes" falsevalue="no" checked="true" />
            </when>
        </conditional>
    </inputs>
    <outputs>
        <!-- TODO, can I get the caption rather than the value? e.g. 'NT' rather than a long path? -->
        <data name="output1" format="tabular" label="tblastx on ${database.value_label}">
            <change_format>
                <when input="out_format" value="0" format="txt"/>
            </change_format>
            <change_format>
                <when input="out_format" value="5" format="blastxml"/>
            </change_format>
        </data>
    </outputs>
    <requirements>
        <requirement type="binary">blastn</requirement>
    </requirements>
    <tests>
        <test>
            <param name="input_query" value="megablast_wrapper_test1.fa" ftype="fasta"/>
            <!-- database needs to match the entry in the blastdb.loc file (first column), which includes the last update date if appropriate --> 
            <param name="database" value="phiX" />
            <param name="blast_type" value="megablast" />
            <!--
            <param name="word_size" value="28" />
            <param name="iden_cutoff" value="99.0" />
            -->
            <param name="evalue_cutoff" value="10.0" />
            <param name="filter_query" value="yes" />
            <param name="out_format" value="6" />
            <output name="output1" file="megablast_wrapper_test1.out"/> 
        </test>
    </tests>
    <help>
    
.. class:: warningmark

**Note**. Database searches may take substantial amount of time. For large input datasets it is advisable to allow overnight processing.  

-----

**What it does**

Search a *translated nucleotide database* using a *protein query*,
using the NCBI BLAST+ tblastx command line tool.

-----

**Output format**

The default output of this tool is tabular, containing 12 columns:

1. Id of your sequence 
2. GI of the database hit 
3. % identity
4. Alignment length
5. # mismatches
6. # gaps
7. Start position in your sequence
8. End position in your sequence
9. Start position in database hit
10. End position in database hit
11. E-value
12. Bit score

-------

**References**

Altschul et al. Gapped BLAST and PSI-BLAST: a new generation of protein database search programs. 1997. Nucleic Acids Res. 25:3389-3402.

    </help>
</tool>
