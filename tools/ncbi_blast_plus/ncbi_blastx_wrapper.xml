<tool id="ncbi_blastx_wrapper" name="NCBI BLAST+ blastx" version="0.0.1">
    <description>Search protein database with translated nucleotide query sequence(s)</description>
    <command>
      blastx
       -query "$query"
       -db "$database"
       -evalue $evalue_cutoff
       $adv_opts.filter_query
       $adv_opts.strand
       -out $output1
       -outfmt $out_format
       -num_threads 8
    </command>
    <inputs>
        <param name="query" type="data" format="fasta" label="Nucleotide query sequence(s)"/> 
        <param name="database" type="select" display="radio" label="Protein BLAST database">
            <options from_file="blastdb_p.loc">
              <column name="name" index="0"/>
              <column name="value" index="1"/>
            </options>
        </param>
        <param name="evalue_cutoff" type="float" size="15" value="0.001" label="set expectation value cutoff" />
        <param name="out_format" type="select" label="Output format">
            <option value="6">Tabular</option>
            <option value="5">BLAST XML</option>
            <option value="0">Pairwise text</option>
            <!--
            <option value="11">BLAST archive format (ASN.1)</option>
            -->
        </param>
        <conditional name="adv_opts">
            <param name="adv_opts_selector" type="select" label="Advanced Options">
              <option value="basic" selected="True">Hide Advanced Options</option>
              <option value="advanced">Show Advanced Options</option>
            </param>
            <when value="basic">
                <param name="filter_query" type="hidden" value="" />
                <param name="strand" type="hidden" value="" />
            </when>
            <when value="advanced">
                <!-- Could use a select (yes, no, other) where other allows setting 'window locut hicut' -->
                <param name="filter_query" type="boolean" label="Filter out low complexity regions (with SEG)" truevalue="-seg yes" falsevalue="-seg no" checked="true" />
                <param name="strand" type="select" label="Query strand(s) to search against database/subject">
                    <option value="-strand both">Both</option>
                    <option value="-strand plus">Plus (forward)</option>
                    <option value="-strand minus">Minus (reverse complement)</option>
                </param>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <!-- TODO, can I get the caption rather than the value? e.g. 'NR' rather than a long path? -->
        <data name="output1" format="tabular" label="blastx on ${database.value_label}">
            <change_format>
                <when input="out_format" value="0" format="txt"/>
            </change_format>
            <change_format>
                <when input="out_format" value="5" format="blastxml"/>
            </change_format>
        </data>
    </outputs>
    <requirements>
        <requirement type="binary">blastn</requirement>
    </requirements>
    <tests>
    </tests>
    <help>
    
.. class:: warningmark

**Note**. Database searches may take substantial amount of time.
For large input datasets it is advisable to allow overnight processing.  

-----

**What it does**

Search a *protein database* using a *translated nucleotide query*,
using the NCBI BLAST+ blastx command line tool.

-----

**Output format**

The default output of this tool is tabular, containing 12 columns:

1. Id of your sequence 
2. GI of the database hit 
3. % identity
4. Alignment length
5. # mismatches
6. # gaps
7. Start position in your sequence
8. End position in your sequence
9. Start position in database hit
10. End position in database hit
11. E-value
12. Bit score

-------

**References**

Altschul et al. Gapped BLAST and PSI-BLAST: a new generation of protein database search programs. 1997. Nucleic Acids Res. 25:3389-3402.

    </help>
</tool>
