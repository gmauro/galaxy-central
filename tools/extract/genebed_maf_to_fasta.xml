<tool id="GeneBed_Maf_Fasta1" name="Stitch Gene blocks">
  <description>given a set of coding exon intervals</description>
  <command interpreter="python2.4">
    #if $maf_source_type.maf_source == "user":#genebed_maf_to_fasta_user.py $dbkey $maf_source_type.species $maf_source_type.input2 $input1 $out_file1 -
    #else:#genebed_maf_to_fasta.py $dbkey $maf_source_type.species $maf_source_type.maf_uid $input1 $out_file1 -
    #end if
  </command>
  <inputs>
    <param name="input1" type="data" format="bed" label="Gene BED File"/>
    <conditional name="maf_source_type">
      <param name="maf_source" type="select" label="MAF Source">
        <option value="cached" selected="true">Locally Cached Alignments</option>
        <option value="user">Alignments in Your History</option>
      </param>
      <when value="user">
        <param name="input2" type="data" format="maf" label="MAF File" />	
	    <param name="species" type="select" display="checkboxes" multiple="true" label="Choose species" help="Select species to be included in the final alignment">
	      <select_options data_ref="input2" func="get_options_for_species_for_maf">
	        <func_param name="maf_source" value="user" />
	      </select_options>
	    </param>
      </when>
      <when value="cached">
        <param name="maf_uid" type="select" label="MAF Type" >
          <select_options from_file="/depot/data2/galaxy/maf_index.loc" data_ref="input1" func="get_options_for_maf" />
        </param>
	    <param name="species" type="select" display="checkboxes" multiple="true" label="Choose species" help="Select species to be included in the final alignment">
	      <select_options param_ref="maf_uid" from_file="/depot/data2/galaxy/maf_index.loc" func="get_options_for_species_for_maf">
	        <func_param name="maf_source" value="cached" />
	      </select_options>
	    </param>
      </when>
    </conditional>
   </inputs>
  <outputs>
    <data format="fasta" name="out_file1" />
  </outputs>
  <tests>
    <test>
      <param name="input1" value="8.bed"/>
      <param name="maf_source" value="cached"/>
      <param name="maf_uid" value="8_WAY_MULTIZ_hg17"/>
      <param name="species" value="canFam1,hg17,mm5,panTro1,rn3"/>
      <output name="out_file1" file="gene_bed_maf_to_fasta_out.fasta" />
    </test>
    <test>
      <param name="input1" value="8.bed"/>
      <param name="input2" value="4.maf"/>
      <param name="maf_source" value="user"/>
      <param name="species" value="hg17,panTro1"/>
      <output name="out_file1" file="gene_bed_maf_to_fasta_user_out.fasta" />
    </test>
  </tests> 
  <help>

**What it does**

The coding sequence of genes are usually composed of several coding exons. Each of these coding exons is an individual genomic region, which when concatenated with each other constitutes the coding sequence. A single genomic region can be covered by multiple alignment blocks. In many cases it is desirable to stitch these alignment blocks together. This tool accepts a list of gene-based intervals, in the Gene BED format. For every interval it performs the following:

  * finds all MAF blocks that overlap the coding regions;
  * sorts MAF blocks by alignment score;
  * stitches blocks together and resolves overlaps based on alignment score;
  * outputs alignments in FASTA format.


  </help>
</tool>
