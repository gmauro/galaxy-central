(function(g){jQuery.event.props.push("dataTransfer");var c={url:"",paramname:"content",maxfilesize:250,dragover:function(){},dragleave:function(){},announce:function(){},initialize:function(){},progress:function(){},success:function(){},error:function(i,j,k){alert(k)},error_browser:"Your browser does not support drag-and-drop file uploads.",error_filesize:"This file is too large (>250MB). Please use an FTP client to upload it.",error_default:"Please make sure the file is available.",text_default:"Drag&drop files into this box or click 'Select' to select files!",text_degrade:"Unfortunately, your browser does not support multiple file uploads or drag&drop.<br>Please upgrade to i.e. Firefox 4+, Chrome 7+, IE 10+, Opera 12+ or Safari 6+."};var f={};var a={};var b=0;var d=0;var h=false;var e=null;g.fn.uploadbox=function(i){f=g.extend({},c,i);var o=window.File&&window.FileReader&&window.FormData&&window.XMLHttpRequest;e=this;e.append('<input id="uploadbox_input" type="file" style="display: none" multiple>');e.append('<div id="uploadbox_info"></div>');if(o){e.find("#uploadbox_info").html(f.text_default)}else{e.find("#uploadbox_info").html(f.text_degrade)}e.on("drop",n);e.on("dragover",u);e.on("dragleave",t);g("#uploadbox_input").change(function(A){p(A.target.files)});function n(A){if(!A.dataTransfer){return}p(A.dataTransfer.files);A.preventDefault();return false}function u(A){A.preventDefault();f.dragover.call(A)}function t(A){A.stopPropagation();f.dragleave.call(A)}function k(A){if(A.lengthComputable){f.progress(this.index,this.file,Math.round((A.loaded*100)/A.total))}}function p(C){for(var B=0;B<C.length;B++){var A=String(++b);a[A]=C[B];d++;f.announce(A,a[A],"")}}function z(A){if(a[A]){delete a[A];d--}}function q(){var D=-1;for(var F in a){D=F;break}if(d==0){return}var E=a[D];z(D);var H=f.initialize(D,E,j);try{var B=new FileReader();var C=E.size;var A=1048576*f.maxfilesize;B.index=D;if(C<A){B.onload=function(I){l(D,E,H)};B.onerror=function(I){s(D,E,f.error_default)};B.readAsDataURL(E)}else{s(D,E,f.error_filesize)}}catch(G){s(D,E,G)}}function l(A,C,D){var E=new FormData();for(var B in D){E.append(B,D[B])}E.append(f.paramname,C,C.name);var F=new XMLHttpRequest();F.upload.index=A;F.upload.file=C;F.upload.addEventListener("progress",k,false);F.open("POST",f.url,true);F.setRequestHeader("Accept","application/json");F.setRequestHeader("Cache-Control","no-cache");F.setRequestHeader("X-Requested-With","XMLHttpRequest");F.send(E);F.onloadend=function(){var G=null;if(F.responseText){try{G=jQuery.parseJSON(F.responseText)}catch(H){G=F.responseText}}if(F.status<200||F.status>299){var I=F.statusText;if(!F.statusText){I=f.error_default}s(A,C,I+" (Server Code "+F.status+")")}else{m(A,C,G)}}}function m(A,B,C){f.success(A,B,C);q()}function s(A,B,C){f.error(A,B,C);q()}function r(){g("#uploadbox_input").trigger("click")}function x(A){for(A in a){z(A)}}function w(){if(!h){q()}}function j(){return d}function y(A){f=g.extend({},f,A);return f}function v(){return e.find("#uploadbox_info")}return{select:r,remove:z,upload:w,reset:x,length:j,configure:y,info:v}}})(jQuery);