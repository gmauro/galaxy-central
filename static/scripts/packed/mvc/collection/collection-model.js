define(["mvc/dataset/dataset-model","mvc/base-mvc","utils/localization"],function(b,o,e){var f={defaults:{model_class:"DatasetCollectionElement",element_identifier:null,element_index:null,element_type:null},_mergeObject:function(q){_.extend(q,q.object);delete q.object;return q},constructor:function(q,r){this.debug("\t DatasetCollectionElement.constructor:",q,r);q=this._mergeObject(q);Backbone.Model.apply(this,arguments)},parse:function(r,s){var q=r;q=this._mergeObject(q);return q}};var p=Backbone.Model.extend(o.LoggableMixin).extend(f);var m=Backbone.Collection.extend(o.LoggableMixin).extend({model:p,initialize:function(q,r){this.debug(this+"(DCECollection).initialize:",q,r);r=r||{}},toString:function(){return(["DatasetCollectionElementCollection(",this.length,")"].join(""))}});var g=b.DatasetAssociation.extend(o.mixin(f,{defaults:_.extend({},b.DatasetAssociation.prototype.defaults,f.defaults),constructor:function(q,r){this.debug("\t DatasetDCE.constructor:",q,r);f.constructor.call(this,q,r)},initialize:function(q,r){this.debug(this+"(DatasetDCE).initialize:",q,r);b.DatasetAssociation.prototype.initialize.call(this,q,r)},toString:function(){var q=this.get("element_identifier");return(["DatasetDCE(",q,")"].join(""))}}));var l=m.extend({model:g,initialize:function(q,r){this.debug(this+"(DatasetDCECollection).initialize:",q,r);m.prototype.initialize.call(this,q,r)},toString:function(){return(["DatasetDCECollection(",this.length,")"].join(""))}});var i=Backbone.Model.extend(o.LoggableMixin).extend(o.SearchableModelMixin).extend({defaults:{collection_type:null,deleted:false},collectionClass:m,initialize:function(r,q){this.debug(this+"(DatasetCollection).initialize:",r,q,this);this.elements=this._createElementsModel();this.on("change:elements",function(){this.log("change:elements");this.elements=this._createElementsModel()})},_createElementsModel:function(){this.debug(this+"._createElementsModel",this.collectionClass,this.get("elements"),this.elements);var q=this.get("elements")||[];this.unset("elements",{silent:true});this.elements=new this.collectionClass(q);return this.elements},toJSON:function(){var q=Backbone.Model.prototype.toJSON.call(this);if(this.elements){q.elements=this.elements.toJSON()}return q},inReadyState:function(){return true},hasDetails:function(){this.debug("hasDetails:",this.elements.length);return this.elements.length!==0},getVisibleContents:function(q){return this.elements},"delete":function(q){if(this.get("deleted")){return jQuery.when()}return this.save({deleted:true},q)},undelete:function(q){if(!this.get("deleted")||this.get("purged")){return jQuery.when()}return this.save({deleted:false},q)},searchAttributes:["name"],toString:function(){var q=[this.get("id"),this.get("name")||this.get("element_identifier")];return"DatasetCollection("+(q.join(","))+")"}});var h=i.extend({collectionClass:l,initialize:function(r,q){this.debug(this+"(ListDatasetCollection).initialize:",r,q);i.prototype.initialize.call(this,r,q)},toString:function(){return(["ListDatasetCollection(",this.get("name"),")"].join(""))}});var d=h.extend({initialize:function(r,q){this.debug(this+"(PairDatasetCollection).initialize:",r,q);h.prototype.initialize.call(this,r,q)},toString:function(){return(["PairDatasetCollection(",this.get("name"),")"].join(""))}});var j=i.extend(o.mixin(f,{constructor:function(q,r){this.debug("\t NestedDCDCE.constructor:",q,r);f.constructor.call(this,q,r)},toString:function(){var q=(this.object)?(""+this.object):(this.get("element_identifier"));return(["NestedDCDCE(",q,")"].join(""))}}));var n=m.extend({model:j,initialize:function(r,q){this.debug(this+"(NestedDCDCECollection).initialize:",r,q);m.prototype.initialize.call(this,r,q)},toString:function(){return(["NestedDCDCECollection(",this.length,")"].join(""))}});var a=d.extend(o.mixin(f,{constructor:function(q,r){this.debug("\t NestedPairDCDCE.constructor:",q,r);f.constructor.call(this,q,r)},toString:function(){var q=(this.object)?(""+this.object):(this.get("element_identifier"));return(["NestedPairDCDCE(",q,")"].join(""))}}));var k=n.extend({model:a,initialize:function(r,q){this.debug(this+"(NestedPairDCDCECollection).initialize:",r,q);n.prototype.initialize.call(this,r,q)},toString:function(){return(["NestedPairDCDCECollection(",this.length,")"].join(""))}});var c=i.extend({collectionClass:k,initialize:function(q,r){this.debug(this+"(ListPairedDatasetCollection).initialize:",q,r);i.prototype.initialize.call(this,q,r)},toString:function(){return(["ListPairedDatasetCollection(",this.get("name"),")"].join(""))}});return{ListDatasetCollection:h,PairDatasetCollection:d,ListPairedDatasetCollection:c}});