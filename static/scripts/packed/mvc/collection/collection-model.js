define(["mvc/dataset/hda-model","mvc/base-mvc","utils/localization"],function(h,l,d){var m=Backbone.Model.extend(l.LoggableMixin).extend({defaults:{model_class:"DatasetCollectionElement",element_identifier:null,element_index:null,element_type:null},initialize:function(o,n){this.info(this+".initialize:",o,n);n=n||{};this.object=this._createObjectModel();this.on("change:object",function(){this.object=this._createObjectModel()})},_createObjectModel:function(){if(_.isUndefined(this.object)){this.object=null}if(!this.get("object")){return this.object}var n=this.get("object"),o=this._getObjectClass();this.unset("object",{silent:true});this.object=new o(n);return this.object},_getObjectClass:function(){this.debug("DCE, element_type:",this.get("element_type"));switch(this.get("element_type")){case"dataset_collection":return g;case"hda":return h.HistoryDatasetAssociation}throw new TypeError("Unknown element_type: "+this.get("element_type"))},toJSON:function(){var n=Backbone.Model.prototype.toJSON.call(this);if(this.object){n.object=this.object.toJSON()}return n},hasDetails:function(){return(this.object!==null&&this.object.hasDetails())},toString:function(){var n=(this.object)?(""+this.object):(this.get("element_identifier"));return(["DatasetCollectionElement(",n,")"].join(""))}});var i=m.extend({_getObjectClass:function(){return h.HistoryDatasetAssociation},toString:function(){var n=(this.object)?(""+this.object):(this.get("element_identifier"));return(["HDADCE(",n,")"].join(""))}});var a=m.extend({_getObjectClass:function(){return g},getVisibleContents:function(){return this.object?this.object.getVisibleContents():[]},toString:function(){var n=(this.object)?(""+this.object):(this.get("element_identifier"));return(["DCDCE(",n,")"].join(""))}});var k=Backbone.Collection.extend(l.LoggableMixin).extend({model:m,initialize:function(o,n){n=n||{};this.info(this+".initialize:",o,n)},toString:function(){return(["DatasetCollectionElementCollection(",this.length,")"].join(""))}});var j=k.extend({model:i,toString:function(){return(["HDADCECollection(",this.length,")"].join(""))}});var f=k.extend({model:a,toString:function(){return(["DCDCECollection(",this.length,")"].join(""))}});var g=Backbone.Model.extend(l.LoggableMixin).extend({defaults:{collection_type:"list"},collectionClass:k,initialize:function(o,n){this.info("DatasetCollection.initialize:",o,n);this.elements=this._createElementsModel();this.on("change:elements",function(){this.log("change:elements");this.elements=this._createElementsModel()})},_createElementsModel:function(){this.log("_createElementsModel",this.get("elements"),this.elements);var n=this.get("elements")||[];this.info("elements:",n);this.unset("elements",{silent:true});this.elements=new this.collectionClass(n);return this.elements},toJSON:function(){var n=Backbone.Model.prototype.toJSON.call(this);if(this.elements){n.elements=this.elements.toJSON()}return n},hasDetails:function(){this.debug("hasDetails:",this.elements.length);return this.elements.length!==0},getVisibleContents:function(n){return this.elements},toString:function(){var n=[this.get("id"),this.get("name")||this.get("element_identifier")];return"DatasetCollection("+(n.join(","))+")"}});var e=g.extend({collectionClass:j,toString:function(){return(["ListDatasetCollection(",this.get("name"),")"].join(""))}});var c=e.extend({toString:function(){return(["PairDatasetCollection(",this.get("name"),")"].join(""))}});var b=g.extend({collectionClass:f,toString:function(){return(["ListPairedDatasetCollection(",this.get("name"),")"].join(""))}});return{ListDatasetCollection:e,PairDatasetCollection:c,ListPairedDatasetCollection:b}});