define(["mvc/base-mvc","utils/localization"],function(c,e){var b=Backbone.View.extend(c.LoggableMixin).extend({className:"dataset-collection",fxSpeed:"fast",initialize:function(g){if(g.logger){this.logger=this.model.logger=g.logger}this.log("DCBaseView.initialize:",g)},render:function(h){var g=this._buildNewRender();this._queueNewRender(g,h);return this},_buildNewRender:function(){var g=$(this.templates.skeleton(this.model.toJSON()));g.find(".primary-actions").append(this._render_primaryActions());this._setUpBehaviors(g);return g},_queueNewRender:function(h,i){i=(i===undefined)?(true):(i);var g=this;if(i){$(g).queue(function(j){this.$el.fadeOut(g.fxSpeed,j)})}$(g).queue(function(j){this.$el.empty().attr("class",g.className).append(h.children());j()});if(i){$(g).queue(function(j){this.$el.fadeIn(g.fxSpeed,j)})}$(g).queue(function(j){this.trigger("rendered",g);j()})},_setUpBehaviors:function(g){g=g||this.$el;make_popup_menus(g);g.find("[title]").tooltip({placement:"bottom"})},_render_primaryActions:function(){return[]},events:{"click .title-bar":function(g){this.trigger("expanded",this)}},toString:function(){var g=(this.model)?(this.model+""):("(no model)");return"DCBaseView("+g+")"}});b.templates=b.prototype.templates=(function(){var g=_.template(['<div class="dataset-collection">','<div class="primary-actions"></div>','<div class="title-bar clear" tabindex="0">','<div class="title">','<span class="name"><%- collection.element_identifier %></span>',"</div>","</div>",'<div class="details"></div>',"</div>"].join(""));var h=_.template(['<div class="details">','<div class="summary">',e("A dataset collection."),"</div>","</div>"].join(""));return{skeleton:function(i){return g({_l:e,collection:i})},body:function(i){return h({_l:e,collection:i})}}}());var f=c.ExpandableView.extend({className:"dataset-collection-element collection-dataset dataset",fxSpeed:"fast",initialize:function(g){if(g.logger){this.logger=this.model.logger=g.logger}this.log("DCEBaseView.initialize:",g);c.ExpandableView.prototype.initialize.call(this,g)},_renderDetails:function(){var g=$(this.templates.details(this.model.toJSON()));this._setUpBehaviors(g);if(this.expanded){g.show()}return g},events:{"click .title-bar":"_clickTitleBar","keydown .title-bar":"_keyDownTitleBar"},_clickTitleBar:function(g){g.stopPropagation();this.toggleExpanded()},_keyDownTitleBar:function(i){var g=32,h=13;if(i&&(i.type==="keydown")&&(i.keyCode===g||i.keyCode===h)){this.toggleExpanded();i.stopPropagation();return false}return true},toString:function(){var g=(this.model)?(this.model+""):("(no model)");return"DCEBaseView("+g+")"}});f.templates=f.prototype.templates=(function(){var g=_.template(['<div class="dataset-collection-element collection-dataset dataset">','<div class="primary-actions"></div>','<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="name"><%- collection.element_identifier %></span>',"</div>","</div>",'<div class="details"></div>',"</div>"].join(""));var h=_.template(['<div class="details">','<div class="summary">',e("A dataset collection element."),"</div>","</div>"].join(""));return{skeleton:function(i){return g({_l:e,collection:i})},body:function(i){return h({_l:e,collection:i})}}}());var d=f.extend({toString:function(){var g=(this.model)?(this.model+""):("(no model)");return"HDADCEBaseView("+g+")"}});d.templates=d.prototype.templates=(function(){var g=_.template(['<div class="dataset-collection-element dataset">','<div class="primary-actions"></div>','<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="name"><%- element.element_identifier %></span>',"</div>","</div>",'<div class="details"></div>',"</div>"].join(""));var h=_.template(['<div class="details">','<div class="summary">',"<% if( hda.misc_blurb ){ %>",'<div class="blurb">','<span class="value"><%- hda.misc_blurb %></span>',"</div>","<% } %>","<% if( hda.data_type ){ %>",'<div class="datatype">','<label class="prompt">',e("format"),"</label>",'<span class="value"><%- hda.data_type %></span>',"</div>","<% } %>","<% if( hda.metadata_dbkey ){ %>",'<div class="dbkey">','<label class="prompt">',e("database"),"</label>",'<span class="value">',"<%- hda.metadata_dbkey %>","</span>","</div>","<% } %>","<% if( hda.misc_info ){ %>",'<div class="info">','<span class="value"><%- hda.misc_info %></span>',"</div>","<% } %>","</div>",'<div class="actions clear">','<div class="left"></div>','<div class="right"></div>',"</div>","<% if( !hda.deleted ){ %>",'<div class="tags-display"></div>','<div class="annotation-display"></div>','<div class="display-applications">',"<% _.each( hda.display_apps, function( app ){ %>",'<div class="display-application">','<span class="display-application-location"><%- app.label %></span> ','<span class="display-application-links">',"<% _.each( app.links, function( link ){ %>",'<a target="<%= link.target %>" href="<%= link.href %>">',"<% print( _l( link.text ) ); %>","</a> ","<% }); %>","</span>","</div>","<% }); %>","<% _.each( hda.display_types, function( app ){ %>",'<div class="display-application">','<span class="display-application-location"><%- app.label %></span> ','<span class="display-application-links">',"<% _.each( app.links, function( link ){ %>",'<a target="<%= link.target %>" href="<%= link.href %>">',"<% print( _l( link.text ) ); %>","</a> ","<% }); %>","</span>","</div>","<% }); %>","</div>","<% if( hda.peek ){ %>",'<pre class="dataset-peek"><%= hda.peek %></pre>',"<% } %>","<% } %>","</div>"].join(""));return{skeleton:function(i){return g({_l:e,element:i,hda:i.object})},details:function(i){return h({_l:e,element:i,hda:i.object})}}}());var a=f.extend({expand:function(){this.trigger("expanded",this)},toString:function(){var g=(this.model)?(this.model+""):("(no model)");return"DCDCEBaseView("+g+")"}});a.templates=a.prototype.templates=(function(){var g=_.template(['<div class="dataset-collection-element dataset-collection">','<div class="primary-actions"></div>','<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="name"><%- element.element_identifier %></span>',"</div>",'<div class="subtitle">',e("paired datasets"),"</div>","</div>",'<div class="details"></div>',"</div>"].join(""));return{skeleton:function(h){return g({_l:e,element:h,collection:h.object})}}}());return{DCBaseView:b,DCEBaseView:f,HDADCEBaseView:d,DCDCEBaseView:a}});