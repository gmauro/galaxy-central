define(["utils/utils","mvc/upload/upload-model","mvc/upload/upload-settings","mvc/ui/ui-popover","mvc/ui/ui-select"],function(e,t,n,r,i){return Backbone.View.extend({options:{padding:8},status_classes:{init:"upload-icon-button fa fa-trash-o",queued:"upload-icon fa fa-spinner fa-spin",running:"upload-icon fa fa-spinner fa-spin",success:"upload-icon-button fa fa-check",error:"upload-icon-button fa fa-exclamation-triangle"},settings:null,select_genome:null,select_extension:null,initialize:function(e,n){this.app=e;var s="Auto-detect",o=this;this.model=new t.Model(n),this.setElement(this._template(n));var u=this.$el;this.settings=new r.View({title:"Upload configuration",container:u.find("#settings"),placement:"bottom"}),this.select_genome=new i.View({css:"genome",onchange:function(){o.model.set("genome",o.select_genome.value())},data:o.app.list_genomes,container:u.find("#genome"),value:o.model.get("genome")}),this.model.set("genome",o.select_genome.value()),this.app.select_extension.value()!=="---"&&(this.default_ext=this.app.select_extension.value()),this.select_extension=new i.View({css:"extension",onchange:function(){o.model.set("extension",o.select_extension.value());if(o.select_extension.value()!==e.select_extension.value()){var t="---";e.select_extension.value(t)}},data:o.app.list_extensions,container:u.find("#extension"),value:o.default_ext}),this.model.set("extension",o.select_extension.value()),u.find("#symbol").on("click",function(){o._removeRow()}),u.find("#extension-info").on("click",function(e){o._showExtensionInfo()}).on("mousedown",function(e){e.preventDefault()}),u.find("#settings").on("click",function(e){o._showSettings()}).on("mousedown",function(e){e.preventDefault()}),u.find("#text-content").on("keyup",function(e){o.model.set("url_paste",$(e.target).val()),o.model.set("file_size",$(e.target).val().length)}),u.find("#space_to_tabs").on("change",function(e){o.model.set("space_to_tabs",$(e.target).prop("checked"))}),this.model.on("change:percentage",function(){o._refreshPercentage()}),this.model.on("change:status",function(){o._refreshStatus()}),this.model.on("change:info",function(){o._refreshInfo()}),this.model.on("change:genome",function(){o._refreshGenome()}),this.model.on("change:file_size",function(){o._refreshFileSize()}),this.model.on("remove",function(){o.remove()}),this.app.collection.on("reset",function(){o.remove()}),o.model.set("row",o)},render:function(){var t=this.model.get("file_name"),n=this.model.get("file_size"),r=this.model.get("file_mode"),i=this.$el;i.find("#title").html(t),i.find("#size").html(e.bytesToString(n)),i.find("#mode").removeClass().addClass("mode");if(r=="new"){var s=i.find("#text"),o=this.options.padding,u=i.width()-2*o,a=i.height()-o;s.css("width",u+"px"),s.css("top",a+"px"),i.height(a+s.height()+2*o),s.show(),i.find("#mode").addClass("fa fa-pencil")}r=="local"&&i.find("#mode").addClass("fa fa-laptop"),r=="ftp"&&i.find("#mode").addClass("fa fa-code-fork")},remove:function(){this.select_genome.remove(),this.select_extension.remove(),Backbone.View.prototype.remove.apply(this)},_refreshGenome:function(){var e=this.model.get("genome");this.select_genome.value(e)},_refreshInfo:function(){var e=this.model.get("info");e?this.$el.find("#info").html("<strong>Failed: </strong>"+e).show():this.$el.find("#info").hide()},_refreshPercentage:function(){var e=parseInt(this.model.get("percentage"));this.$el.find(".progress-bar").css({width:e+"%"}),e!=100?this.$el.find("#percentage").html(e+"%"):this.$el.find("#percentage").html("Adding to history...")},_refreshStatus:function(){var e=this.$el,t=this.model.get("status"),n=this.status_classes[t],r=this.$el.find("#symbol");r.removeClass(),r.addClass(n),t=="init"?(this.select_genome.enable(),this.select_extension.enable(),e.find("#text-content").attr("disabled",!1),e.find("#space_to_tabs").attr("disabled",!1)):(this.select_genome.disable(),this.select_extension.disable(),e.find("#text-content").attr("disabled",!0),e.find("#space_to_tabs").attr("disabled",!0)),t=="success"&&(e.addClass("success"),e.find("#percentage").html("100%")),t=="error"&&(e.addClass("danger"),e.find(".progress").remove())},_refreshFileSize:function(){var t=this.model.get("file_size");this.$el.find("#size").html(e.bytesToString(t))},_removeRow:function(){var e=this.model.get("status");(e=="init"||e=="success"||e=="error")&&this.app.collection.remove(this.model)},_showExtensionInfo:function(){var e=$(this.el).find("#extension-info"),t=this.model.get("extension"),n=this.select_extension.text(),i=_.findWhere(this.app.list_extensions,{id:t});this.extension_popup||(this.extension_popup=new r.View({placement:"bottom",container:e})),this.extension_popup.visible?this.extension_popup.hide():(this.extension_popup.title(n),this.extension_popup.empty(),this.extension_popup.append(this._templateDescription(i)),this.extension_popup.show())},_showSettings:function(){this.settings.visible?this.settings.hide():(this.settings.empty(),this.settings.append((new n(this)).$el),this.settings.show())},_templateDescription:function(e){if(e.description){var t=e.description;return e.description_url&&(t+='&nbsp;(<a href="'+e.description_url+'" target="_blank">read more</a>)'),t}return"There is no description available for this file extension."},_template:function(e){return'<tr id="upload-item-'+e.id+'" class="upload-item">'+"<td>"+'<div style="position: relative;">'+'<div id="mode"></div>'+'<div id="title" class="title"></div>'+'<div id="text" class="text">'+'<div class="text-info">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div>'+'<textarea id="text-content" class="text-content form-control"></textarea>'+"</div>"+"</div>"+"</td>"+"<td>"+'<div id="size" class="size"></div>'+"</td>"+"<td>"+'<div id="extension" class="extension" style="float: left;"/>&nbsp;&nbsp'+'<div id="extension-info" class="upload-icon-button fa fa-search"/>'+"</td>"+"<td>"+'<div id="genome" class="genome" />'+"</td>"+'<td><div id="settings" class="upload-icon-button fa fa-gear"></div>'+"<td>"+'<div id="info" class="info">'+'<div class="progress">'+'<div class="progress-bar progress-bar-success"></div>'+'<div id="percentage" class="percentage">0%</div>'+"</div>"+"</div>"+"</td>"+"<td>"+'<div id="symbol" class="'+this.status_classes.init+'"></div>'+"</td>"+"</tr>"}})});