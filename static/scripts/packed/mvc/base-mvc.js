define(["utils/add-logging"],function(d){var f={logger:null,_logNamespace:"?",log:function(){if(this.logger){var g=this.logger.log;if(typeof this.logger.log==="object"){g=Function.prototype.bind.call(this.logger.log,this.logger)}return g.apply(this.logger,arguments)}return undefined}};d(f);var b=Backbone.Model.extend({initialize:function(h){this._checkEnabledSessionStorage();if(!h.id){throw new Error("SessionStorageModel requires an id in the initial attributes")}this.id=h.id;var g=(!this.isNew())?(this._read(this)):({});this.clear({silent:true});this.save(_.extend({},this.defaults,g,h),{silent:true});this.on("change",function(){this.save()})},_checkEnabledSessionStorage:function(){try{return sessionStorage.length}catch(g){alert("Please enable cookies in your browser for this Galaxy site");return false}},sync:function(j,h,g){if(!g.silent){h.trigger("request",h,{},g)}var i;switch(j){case"create":i=this._create(h);break;case"read":i=this._read(h);break;case"update":i=this._update(h);break;case"delete":i=this._delete(h);break}if(i!==undefined||i!==null){if(g.success){g.success()}}else{if(g.error){g.error()}}return i},_create:function(g){var h=g.toJSON(),i=sessionStorage.setItem(g.id,JSON.stringify(h));return(i===null)?(i):(h)},_read:function(g){return JSON.parse(sessionStorage.getItem(g.id))},_update:function(g){return g._create(g)},_delete:function(g){return sessionStorage.removeItem(g.id)},isNew:function(){return !sessionStorage.hasOwnProperty(this.id)},_log:function(){return JSON.stringify(this.toJSON(),null,"  ")},toString:function(){return"SessionStorageModel("+this.id+")"}});(function(){b.prototype=_.omit(b.prototype,"url","urlRoot")}());var c={hiddenUntilActivated:function(g,i){i=i||{};this.HUAVOptions={$elementShown:this.$el,showFn:jQuery.prototype.toggle,showSpeed:"fast"};_.extend(this.HUAVOptions,i||{});this.HUAVOptions.hasBeenShown=this.HUAVOptions.$elementShown.is(":visible");this.hidden=this.isHidden();if(g){var h=this;g.on("click",function(j){h.toggle(h.HUAVOptions.showSpeed)})}},isHidden:function(){return(this.HUAVOptions.$elementShown.is(":hidden"))},toggle:function(){if(this.hidden){if(!this.HUAVOptions.hasBeenShown){if(_.isFunction(this.HUAVOptions.onshowFirstTime)){this.HUAVOptions.hasBeenShown=true;this.HUAVOptions.onshowFirstTime.call(this)}}if(_.isFunction(this.HUAVOptions.onshow)){this.HUAVOptions.onshow.call(this);this.trigger("hiddenUntilActivated:shown",this)}this.hidden=false}else{if(_.isFunction(this.HUAVOptions.onhide)){this.HUAVOptions.onhide.call(this);this.trigger("hiddenUntilActivated:hidden",this)}this.hidden=true}return this.HUAVOptions.showFn.apply(this.HUAVOptions.$elementShown,arguments)}};function a(j,i){var g=Array.prototype.slice.call(arguments,0),h=g.pop();g.unshift(h);return _.defaults.apply(_,g)}var e=Backbone.View.extend(f).extend({initialize:function(g){this.expanded=g.expanded||false;this.log("\t expanded:",this.expanded)},fxSpeed:"fast",render:function(h){var g=this._buildNewRender();this._queueNewRender(g,h);return this},_buildNewRender:function(){var g=$(this.templates.skeleton(this.model.toJSON()));if(this.expanded){g.children(".details").replaceWith(this._renderDetails())}this._setUpBehaviors(g);return g},_queueNewRender:function(h,i){i=(i===undefined)?(this.fxSpeed):(i);var g=this;$(g).queue("fx",[function(j){this.$el.fadeOut(i,j)},function(j){g._swapNewRender(h);j()},function(j){this.$el.fadeIn(i,j)},function(j){this.trigger("rendered",g);j()}])},_swapNewRender:function(g){return this.$el.empty().attr("class",this.className).append(g.children())},_setUpBehaviors:function(g){g=g||this.$el;make_popup_menus(g);g.find("[title]").tooltip({placement:"bottom"})},_renderDetails:function(){return null},toggleExpanded:function(g){g=(g===undefined)?(!this.expanded):(g);if(g){this.expand()}else{this.collapse()}return this},expand:function(){var g=this;function h(){g.$(".details").replaceWith(g._renderDetails());g.expanded=true;g.$(".details").slideDown(g.fxSpeed,function(){g.trigger("expanded",g)})}if(!g.model.hasDetails()){g.model.fetch().always(function(i){h()})}else{h()}},collapse:function(){var g=this;g.expanded=false;this.$(".details").slideUp(g.fxSpeed,function(){g.trigger("collapsed",g)})}});return{LoggableMixin:f,SessionStorageModel:b,HiddenUntilActivatedViewMixin:c,mixin:a,ExpandableView:e}});